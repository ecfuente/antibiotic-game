<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Antibiotic Match Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    body {
      font-family: 'Press Start 2P', cursive, sans-serif;
      background: #d6f5d6; /* pastel green */
      text-align: center;
      padding: 2rem;
      color: #2f4f2f;
    }
    .card {
      background: #f9fff9;
      border-radius: 15px;
      padding: 2rem;
      margin: auto;
      max-width: 600px;
      box-shadow: 6px 6px 0 #a3d3a3;
      border: 3px solid #4caf50;
    }
    .option, .filter-btn {
      display: block;
      padding: 12px;
      margin: 0.7rem auto;
      background: #a7d7a7;
      border: 3px solid #4caf50;
      border-radius: 12px;
      cursor: pointer;
      width: 90%;
      font-weight: bold;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    .option:hover, .filter-btn:hover {
      background-color: #76b376;
      color: white;
    }
    .selected {
      background-color: #5a9f5a !important;
      color: white;
    }
    .correct {
      background-color: #8ef08e !important;
      border-color: #2e8b2e !important;
    }
    .incorrect {
      background-color: #ff8a8a !important;
      border-color: #b22222 !important;
    }
    .score {
      margin-top: 1rem;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }
    .filters label {
      background: #a7d7a7;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      border: 3px solid #4caf50;
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      color: #2f4f2f;
      font-size: 0.8rem;
      transition: background-color 0.3s ease;
    }
    .filters input[type="checkbox"] {
      display: none;
    }
    .filters input[type="checkbox"]:checked + label {
      background-color: #5a9f5a;
      color: white;
      border-color: #2e8b2e;
    }
    img {
      width: 80px;
      margin-bottom: 1rem;
      filter: drop-shadow(2px 2px 1px #4caf50);
    }
    h1 {
      margin-bottom: 0.3rem;
    }
    h2 {
      margin-bottom: 1rem;
      color: #2f4f2f;
    }
    p {
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <img src="microbe-pixel.png" alt="Microbe Mascot" />
  <h1>ðŸ¦  Antibiotic Match Game</h1>
  <div class="filters" id="class-filters">
    <!-- Checkboxes will be generated by JS -->
  </div>
  <button class="filter-btn" onclick="startGame()">Start Game with Selected Classes</button>
  <div class="card" id="game"></div>
  <p class="score" id="score">Score: 0</p>

  <script>
    // Helper shuffle function
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    const antibiotics = [
      {
        name: "Amoxicillin",
        class: "Beta-lactam (Aminopenicillin)",
        covers: ["Gram-positive cocci", "Gram-negative rods"],
        mechanism: "Inhibits cell wall synthesis by binding penicillin-binding proteins",
        sideEffects: "Allergic reactions, rash, diarrhea",
      },
      {
        name: "Nafcillin",
        class: "Beta-lactam (Anti-staphylococcal penicillin)",
        covers: ["Gram-positive cocci", "MSSA"],
        mechanism: "Inhibits cell wall synthesis by binding penicillin-binding proteins",
        sideEffects: "Allergic reactions, interstitial nephritis",
      },
      {
        name: "Piperacillin-tazobactam",
        class: "Beta-lactam + Beta-lactamase inhibitor",
        covers: ["Gram-positive cocci", "Gram-negative rods", "Anaerobes", "Pseudomonas"],
        mechanism: "Inhibits cell wall synthesis; beta-lactamase inhibitor extends spectrum",
        sideEffects: "Allergic reactions, thrombocytopenia",
      },
      {
        name: "Cefazolin",
        class: "1st Gen Cephalosporin",
        covers: ["Gram-positive cocci"],
        mechanism: "Inhibits cell wall synthesis by binding PBPs",
        sideEffects: "Allergic reactions, rash",
      },
      {
        name: "Ceftriaxone",
        class: "3rd Gen Cephalosporin",
        covers: ["Gram-negative rods", "Neisseria"],
        mechanism: "Inhibits cell wall synthesis by binding PBPs",
        sideEffects: "Biliary sludging, allergic reactions",
      },
      {
        name: "Cefepime",
        class: "4th Gen Cephalosporin",
        covers: ["Gram-negative rods", "Pseudomonas"],
        mechanism: "Inhibits cell wall synthesis by binding PBPs",
        sideEffects: "Neurotoxicity, allergic reactions",
      },
      {
        name: "Vancomycin",
        class: "Glycopeptide",
        covers: ["Gram-positive cocci", "MRSA"],
        mechanism: "Inhibits cell wall synthesis by binding D-Ala-D-Ala",
        sideEffects: "Red man syndrome, nephrotoxicity",
      },
      {
        name: "Azithromycin",
        class: "Macrolide",
        covers: ["Atypicals"],
        mechanism: "Inhibits 50S ribosomal subunit, blocks protein synthesis",
        sideEffects: "GI upset, QT prolongation",
      },
      {
        name: "Clindamycin",
        class: "Lincosamide",
        covers: ["Gram-positive cocci", "Anaerobes"],
        mechanism: "Inhibits 50S ribosomal subunit, blocks protein synthesis",
        sideEffects: "C. difficile colitis",
      },
      {
        name: "Doxycycline",
        class: "Tetracycline",
        covers: ["Gram-positive cocci", "Atypicals"],
        mechanism: "Inhibits 30S ribosomal subunit, blocks protein synthesis",
        sideEffects: "Photosensitivity, teeth discoloration",
      },
      {
        name: "Levofloxacin",
        class: "Fluoroquinolone",
        covers: ["Gram-negative rods", "Atypicals", "Pseudomonas"],
        mechanism: "Inhibits DNA gyrase and topoisomerase IV",
        sideEffects: "Tendonitis, QT prolongation",
      },
      {
        name: "Meropenem",
        class: "Carbapenem",
        covers: ["Gram-positive cocci", "Gram-negative rods", "Anaerobes", "Pseudomonas"],
        mechanism: "Inhibits cell wall synthesis by binding PBPs",
        sideEffects: "Seizures (rare), allergic reactions",
      },
      {
        name: "Linezolid",
        class: "Oxazolidinone",
        covers: ["Gram-positive cocci", "MRSA", "VRE"],
        mechanism: "Inhibits 50S ribosomal subunit, prevents initiation complex formation",
        sideEffects: "Bone marrow suppression, serotonin syndrome",
      }
    ];

    // Extract all unique classes from antibiotics for filters
    const allClasses = [...new Set(antibiotics.map(ab => ab.class))].sort();

    // Put coverage options for negative coverage questions
    const allCoverage = [
      "Gram-positive cocci",
      "Gram-negative rods",
      "Anaerobes",
      "Pseudomonas",
      "MRSA",
      "Neisseria",
      "Atypicals",
      "MSSA",
      "VRE"
    ];

    // Generate the class filter checkboxes dynamically
    const filterDiv = document.getElementById("class-filters");
    allClasses.forEach(cls => {
      const id = cls.toLowerCase().replace(/[^a-z0-9]+/g, '-');
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = cls;
      checkbox.id = id;

      const label = document.createElement("label");
      label.htmlFor = id;
      label.textContent = cls;

      filterDiv.appendChild(checkbox);
      filterDiv.appendChild(label);
    });

    let score = 0;
    let currentQuestionIndex = 0;
    let questions = [];
    let answered = false;

    function startGame() {
      score = 0;
      currentQuestionIndex = 0;
      answered = false;
      document.getElementById("score").textContent = `Score: ${score}`;
      document.getElementById("game").innerHTML = "";

      const checkedBoxes = document.querySelectorAll('#class-filters input[type="checkbox"]:checked');
      const selectedClasses = Array.from(checkedBoxes).map(cb => cb.value);

      if (selectedClasses.length === 0) {
        alert("Please select at least one antibiotic class to start the game.");
        return;
      }

      // Filter antibiotics by selected classes
      const filteredAntibiotics = antibiotics.filter(ab => selectedClasses.includes(ab.class));

      if (filteredAntibiotics.length === 0) {
        alert("No antibiotics found for the selected classes.");
        return;
      }

      questions = [];

      // Group antibiotics by class
      const antibioticsByClass = {};
      selectedClasses.forEach(cls => {
        antibioticsByClass[cls] = filteredAntibiotics.filter(ab => ab.class === cls);
      });

      // Generate question pool for selected classes
      let allClassQuestions = [];
      selectedClasses.forEach(cls => {
        const abs = antibioticsByClass[cls];
        let classQuestions = [];

        abs.forEach(ab => {
          // coverage questions: one per coverage type (positive)
          ab.covers.forEach(cov => {
            classQuestions.push({
              antibiotic: ab,
              type: "coverage",
              question: `Does ${ab.name} cover ${cov}?`,
              correctAnswer: "Yes",
              options: ["Yes", "No"],
            });
            // negative coverage question (pick one random coverage not covered)
            const negCovs = allCoverage.filter(c => !ab.covers.includes(c));
            if (negCovs.length > 0) {
              const negCov = negCovs[Math.floor(Math.random() * negCovs.length)];
              classQuestions.push({
                antibiotic: ab,
                type: "coverage",
                question: `Does ${ab.name} cover ${negCov}?`,
                correctAnswer: "No",
                options: ["Yes", "No"],
              });
            }
          });

          // mechanism question (multiple choice)
          let wrongMechs = antibiotics
            .filter(a => a.mechanism !== ab.mechanism)
            .map(a => a.mechanism);
          wrongMechs = shuffleArray(wrongMechs).slice(0, 3);
          let mechOptions = shuffleArray([ab.mechanism, ...wrongMechs]);
          classQuestions.push({
            antibiotic: ab,
            type: "mechanism",
            question: `What is the mechanism of action of ${ab.name}?`,
            correctAnswer: ab.mechanism,
            options: mechOptions,
          });

          // side effects question (multiple choice)
          let wrongSEs = antibiotics
            .filter(a => a.sideEffects !== ab.sideEffects)
            .map(a => a.sideEffects);
          wrongSEs = shuffleArray(wrongSEs).slice(0, 3);
          let seOptions = shuffleArray([ab.sideEffects, ...wrongSEs]);
          classQuestions.push({
            antibiotic: ab,
            type: "sideEffects",
            question: `What are common side effects of ${ab.name}?`,
            correctAnswer: ab.sideEffects,
            options: seOptions,
          });
        });

        allClassQuestions = allClassQuestions.concat(classQuestions);
      });

      // Shuffle all questions and slice first 10
      questions = shuffleArray(allClassQuestions).slice(0, 10);

      showQuestion();
    }

    function showQuestion() {
      answered = false;
      if (currentQuestionIndex >= questions.length) {
        document.getElementById("game").innerHTML = `
          <h2>ðŸŽ‰ Game Over!</h2>
          <p>Your final score is ${score} out of ${questions.length}.</p>
          <button class="filter-btn" onclick="startGame()">Play Again</button>
        `;
        return;
      }

      const q = questions[currentQuestionIndex];
      const gameDiv = document.getElementById("game");
      gameDiv.innerHTML = `
        <h2>Question ${currentQuestionIndex + 1} / ${questions.length}</h2>
        <p style="font-weight:bold; margin-bottom: 1rem;">${q.question}</p>
      `;

      q.options.forEach(option => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.textContent = option;
        btn.onclick = () => selectAnswer(option);
        gameDiv.appendChild(btn);
      });
    }

    function selectAnswer(selectedOption) {
      if (answered) return;
      answered = true;

      const q = questions[currentQuestionIndex];
      const buttons = document.querySelectorAll(".option");

      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === q.correctAnswer) {
          btn.classList.add("correct");
        }
        if (btn.textContent === selectedOption && selectedOption !== q.correctAnswer) {
          btn.classList.add("incorrect");
        }
      });

      if (selectedOption === q.correctAnswer) {
        score++;
        document.getElementById("score").textContent = `Score: ${score}`;
      }

      currentQuestionIndex++;
      setTimeout(showQuestion, 1500);
    }
  </script>
</body>
</html>
